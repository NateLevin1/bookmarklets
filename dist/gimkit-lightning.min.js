let answers=null,room=null,is2DGame=!1;const decoder=new TextDecoder("utf-8"),onWsMessage=function(t){var t=t["data"],n=decoder.decode(t),o=JSON.stringify(n,null,2);if(n.includes("STATE_UPDATE�data��type�GAME_QUESTIONS")){console.log("🚨📣 Received STATE_UPDATE: ",{data:t},o),room||([e,t]=n.match(/�message-([^�]+)�/),room=t);var e,o=n.split("position").slice(1);answers=[];for(const i of o){var[,s]=i.match(/_id�([^�]+)�/),r=Array.from(i.matchAll(/correctã_id�([^�]+)�text�([^�]+)�/g)).map(([,e,t])=>({id:e,text:t}));answers.push({id:s,correctAnswers:r})}}else if(n.includes("DEVICES_STATES_CHANGES")){is2DGame=!0;t=n.indexOf('[{"type":"mc","position":0,');if(-1!==t){let e=n.slice(t);o=e.indexOf('__v":0}]'),n=(e=e.slice(0,o+8),console.log("🚨📣 Received DEVICES_STATES_CHANGES: ",e),JSON.parse(e));answers=new Map;for(const c of n){var a=c._id,l=c.answers.filter(e=>!!e.correct).map(e=>({id:e._id,text:e.text}));console.log(c),answers.set(c.text,{id:a,correctAnswers:l})}}}};let clapping=!1;const clickRepeatedly=e=>{e.click(),requestAnimationFrame(()=>clickRepeatedly(e))},game2DInterval=()=>{if(is2DGame&&answers&&0!==answers.size&&!(1<window.__gimkitLightningWebsocket.readyState)&&!clapping){var e=document.evaluate("//div[text()='Continue']",document,null,XPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue;if(e)e.click(),e.parentElement.style.color="yellow",e.parentElement.parentElement.parentElement.style.transform="scale(99)";else{var e=document.evaluate("//span[text()='Fish Again']",document,null,XPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue,t=(e&&!document.evaluate("//div[contains(text(),'However, your backpack cannot carry more of this fish.')]",document,null,XPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue&&e.click(),Array.from(document.querySelectorAll(".notranslate.lang-en")));if(0!==t.length){var e=t[0].textContent,n=answers.get(e);if(n)for(const o of n.correctAnswers)for(const s of t)s.textContent===o.text&&(s.click(),s.parentElement.style.color="yellow",s.parentElement.parentElement.parentElement.parentElement.parentElement.style.transform="scale(99)");else console.warn("Encountered a question that we don't know: "+e)}}}},clapChecker=(setInterval(game2DInterval,50),()=>{var e=document.querySelector("div.animated.pulse.infinite");e&&e.textContent.startsWith("👏")&&(console.log("Game over!"),clickRepeatedly(e),clapping=!0)});setInterval(clapChecker,250);let answerIndex=0;const regularGameInterval=()=>{if(!(is2DGame||!answers||0===answers.length||1<window.__gimkitLightningWebsocket.readyState||clapping)){var{id:e,correctAnswers:t}=answers[answerIndex];try{window.__gimkitLightningWebsocket.send(Uint8Array.from(`¤type¤dataµblueboat_SEND_MESSAGE¤room®${room}£key±QUESTION_ANSWERED¤dataªquestionId¸${e}¦answer¸${t[0].id}§options¨compressÃ£nsp¡/`,e=>e.charCodeAt(0)))}catch(e){console.error("Error sending correct answer: "+e)}answerIndex=(answerIndex+1)%answers.length}};setInterval(regularGameInterval,750);let oldSend=WebSocket.prototype.send;WebSocket.prototype.send=function(e){setTimeout(()=>{answers||(console.log("❌ Closing websocket for reconnection"),this.close())},5e3);var t=JSON.stringify(decoder.decode(e),null,2);return is2DGame&&(t=t.match(/deviceId�([^�]+)�/))&&(room=t[1]),this.addEventListener("message",onWsMessage.bind(this)),window.__gimkitLightningWebsocket=this,oldSend.call(this,e)};