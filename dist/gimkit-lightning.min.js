let answers=null,room=null,is2DGame=!1,answerIndex=0;if(!window.location.hostname.endsWith("gimkit.com"))throw alert("This bookmarklet only works on gimkit.com!"),new Error("This bookmarklet only works on gimkit.com!");showStatusMsg("Started. Take any action to begin injection.");const decoder=new TextDecoder("utf-8"),onWsMessage=function(t){var t=t["data"],n=decoder.decode(t),s=JSON.stringify(n,null,2);if(n.includes("STATE_UPDATE�data��type�GAME_QUESTIONS")){console.log("🚨📣 Received STATE_UPDATE: ",{data:t},s),room||([e,t]=n.match(/�message-([^�]+)�/),room=t);var e,s=n.split("�_id�").slice(1);answers=[];for(const l of s){var[,o]=l.match(/^([^�]+)�/),a=Array.from(l.matchAll(/correctã_id�([^�]+)�text�([^�]+)�/g)).map(([,e,t])=>({id:e,text:t}));answers.push({id:o,correctAnswers:a})}console.log("🚨 Found answers:",answers),showStatusMsg("Found answers. Beginning auto-answer.")}else if(n.includes("DEVICES_STATES_CHANGES")){is2DGame=is2DGame||!0;t=n.match(/_nextQuestionId.changes���[^�]+�[^�]+��([^�]+)/);if(null!=t){const[,d]=t;s=answers.findIndex(e=>e.id===d);-1===s?console.error("❌ Couldn't find the next question id in the answers: ",{nextQuestionId:d,newAnswerIndex:s,strData:n}):answerIndex=s}t=n.indexOf('"type":"mc","position":0');if(-1!==t){s=n.lastIndexOf("[",t);let e=n.slice(s);t=e.indexOf('__v":0}]'),n=(e=e.slice(0,t+8),JSON.parse(e));answers=[];for(const c of n){var i=c._id,r=c.answers.filter(e=>!!e.correct).map(e=>({id:e._id,text:e.text}));answers.push({questionText:c.text,id:i,correctAnswers:r})}console.log("🚨 Found answers:",answers),showStatusMsg("Found answers. Answer a question to begin auto-answer, press 'b' to toggle.")}}};let clapping=!1;const clickRepeatedly=e=>{e.click(),requestAnimationFrame(()=>clickRepeatedly(e))},game2DInterval=()=>{if(is2DGame&&answers&&0!==answers.length&&!(1<window.__gimkitLightningWebsocket.readyState)&&!clapping){var e=document.evaluate("//div[text()='Continue']",document,null,XPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue;if(e)e.click(),e.parentElement.style.color="yellow",e.parentElement.parentElement.parentElement.style.transform="scale(99)";else{var e=document.evaluate("//span[text()='Fish Again']",document,null,XPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue,t=(e&&!document.evaluate("//div[contains(text(),'However, your backpack cannot carry more of this fish.')]",document,null,XPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue&&e.click(),Array.from(document.querySelectorAll(".notranslate.lang-en")));if(0!==t.length){const n=t[0].textContent;e=answers.find(e=>e.questionText===n);if(e)for(const s of e.correctAnswers)for(const o of t)o.textContent===s.text&&(o.click(),o.parentElement.style.color="yellow",o.parentElement.parentElement.parentElement.parentElement.parentElement.style.transform="scale(99)");else console.warn("Encountered a question that we don't know: "+n)}}}},clapChecker=(setInterval(game2DInterval,50),()=>{var e=document.querySelector("div.animated.pulse.infinite");e&&e.textContent.startsWith("👏")&&(console.log("Game over!"),clickRepeatedly(e),clapping=!0)});setInterval(clapChecker,250);let disableSendAnswers=!1;window.addEventListener("keydown",e=>{"b"==e.key&&(answers?showStatusMsg((disableSendAnswers=!disableSendAnswers)?"Auto-Answer Disabled":"Auto-Answer Enabled"):showStatusMsg("Answers not found yet. Answer a question to begin auto-answer."))});const sendAnswers=()=>{if(!(disableSendAnswers||!answers||0===answers.length||1<window.__gimkitLightningWebsocket.readyState||clapping))if(-1==answerIndex)console.warn("❌ Couldn't find the next question id in the answers");else{var{id:t,correctAnswers:n}=answers[answerIndex];try{let e;e=is2DGame?`\r²MESSAGE_FOR_DEVICE£key¨answered¨deviceIdµ${room}¤data¦answer¸`+n[0].id:`¤type¤dataµblueboat_SEND_MESSAGE¤room®${room}£key±QUESTION_ANSWERED¤dataªquestionId¸${t}¦answer¸${n[0].id}§options¨compressÃ£nsp¡/`,window.__gimkitLightningWebsocket.send(Uint8Array.from(e,e=>e.charCodeAt(0)))}catch(e){console.error("Error sending correct answer: "+e)}answerIndex=(answerIndex+1)%answers.length}};setInterval(sendAnswers,750);let oldSend=WebSocket.prototype.send,lastTriedToCloseWebsocket=0;function showStatusMsg(e){document.getElementById("gimkit-lightning-overlay")?.remove();var t=document.createElement("div");t.id="gimkit-lightning-overlay",t.style.position="fixed",t.style.top="0",t.style.left="0",t.style.width="100%",t.style.height="5rem",t.style.backgroundColor="rgba(0, 0, 0, 0.5)",t.style.color="white",t.style.display="flex",t.style.justifyContent="center",t.style.alignItems="center",t.style.zIndex="999999999",t.style.pointerEvents="none",t.style.fontSize="1.3em",t.textContent="⚡️ Gimkit Lightning: "+e,document.body.appendChild(t),t.animate({opacity:[1,0]},{delay:3e3,duration:1e3,easing:"ease-in-out",fill:"forwards"})}WebSocket.prototype.send=function(e){setTimeout(()=>{!answers&&5e3<Date.now()-lastTriedToCloseWebsocket&&(lastTriedToCloseWebsocket=Date.now(),console.log("❌ Closing websocket for reconnection"),this.close())},5e3);var t=JSON.stringify(decoder.decode(e),null,2);return is2DGame&&(t=t.match(/deviceId�([^�]+)�/))&&(room=t[1]),window.__gimkitLightningWebsocket!=this&&(this.addEventListener("message",onWsMessage.bind(this)),window.__gimkitLightningWebsocket=this,console.log("✅ Bound to websocket")),oldSend.call(this,e)};